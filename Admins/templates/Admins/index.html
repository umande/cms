{% extends 'base.html' %}
{% block body %}
{% include 'header.html' %}
{% load crispy_forms_tags %}
{% load static %}

<script>
  var icon = new google.maps.MarkerImage("http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
  new google.maps.Size(50, 50), new google.maps.Point(0, 0),
  new google.maps.Point(16, 32));

  // console.log(navigator.geolocation);
  const center = [-3.368277, 36.680892];
  var map = null;
  var currentPopup;
  var bounds = new google.maps.LatLngBounds();
  // addMarker
  function addMarker(lat, lng, info) {
          var pt = new google.maps.LatLng(lat, lng, info);
          bounds.extend(pt);
          var marker = new google.maps.Marker({
              position: pt,
              // label: "A",
              icon: icon,
              map: map,
          });
          var popup = new google.maps.InfoWindow({
              content: info,
              maxWidth: 300
          });

  google.maps.event.addListener(popup, "closeclick", function() {
          map.setZoom(14);
          map.panTo(center);
          currentPopup = null;
  });


  //map zoom
  google.maps.event.addListener(marker, "click", function() {
      map.setZoom(17);
      map.setCenter(marker.getPosition());
if (currentPopup != null) {
currentPopup.close();
currentPopup = null;
}
popup.open(map, marker);
currentPopup = popup;
      var name = popup.content;
      var en = name.search("</h1>")
      name = name.slice(22, en);
      var companyName = document.getElementById("companyName").value = name;
      ico();
});


  }
  window.onload = function(){

      map = new google.maps.Map(document.getElementById("map"), {
          // center: new google.maps.LatLng(navigator.geolocation.getCurrentPosition(function( position ){var mylatlong = position.coords.latitude + "," + position.coords.longitude;})),
          center: new google.maps.LatLng(-3.368277, 36.680892),
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false,
          mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR
          },
  
          });

      {% for item in mapData %}
      console.log(item.company__company_name)
      console.log('hellow')
          //addMarker('{{item.company__map_id__lat}}', '{{item.company__map_id__lng}}','<h1 id="firstHeading">'+ '{{item.company__company_name}}' +'</h1>' + '<h4 id="secondHeading" class="firstHeading">'+'{{item.company__company_description}}'+'</h4>'+'<a class="btn" data-bs-toggle="modal" data-bs-target="#myModal">request</a>'); 
      {% endfor %}

  center = bounds.getCenter();
  map.fitBounds(bounds);
  }

      
  var iconSelect;

  function ico(){
      selectedText = document.getElementById('selected-text');
      console.log(selectedText);
      document.getElementById('my-icon-select').addEventListener('changed', function(e){
         selectedText.value = iconSelect.getSelectedValue();
      });

      iconSelect = new IconSelect("my-icon-select", 
          {'selectedIconWidth':76,
          'selectedIconHeight':43,
          'selectedBoxPadding':1,
          'iconsWidth':63,
          'iconsHeight':58,
          'boxIconSpace':1,
          'vectoralIconNumber': 3,
          'horizontalIconNumber': 3});

      var icons = [];
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/micro.png' %}", 'iconValue':'micro'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/center.png'  %}", 'iconValue':'center'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/sedan.png'  %}", 'iconValue':'sedan'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/suv.png'  %}", 'iconValue':'suv'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/minbus.png'  %}", 'iconValue':'minbus'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/limousine.png'  %}", 'iconValue':'limousine'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/crossover.png'  %}", 'iconValue':'crossover'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/pickup.png'  %}", 'iconValue':'pickup'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/hatchback.png'  %}", 'iconValue':'hatchback'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/universal.png'  %}", 'iconValue':'universal'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/sportcar.png'  %}", 'iconValue':'sportcar'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/supervan.png'  %}", 'iconValue':'supervan'});
      icons.push({'iconFilePath':"{% static 'assets/webasset/cartype/minpickup.png'  %}", 'iconValue':'minpickup'});
      
      iconSelect.refresh(icons);

  };
      
  </script>
  <style>
    #map {
      height: 445px;
      width: 100%;
      box-shadow: 0 4px 8px rgba(13, 110, 253, 0.2);
  }
 /* #map:hover{
      border-color: rgba(13, 110, 253, 0.7);
      box-shadow: 0px 0px 10px 2px rgba(13, 110, 253, 0.6);
  }*/
  </style>
  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="{% url 'Admins' %}">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'users' %}">
          <i class="ri-car-line"></i><span>Carwash</span><i></i>
        </a>
      </li><!-- End user Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'customer' %}">
          <i class="bi bi-people"></i><span>Customer</span><i></i>
        </a>
      </li><!-- End customer Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'request_user' %}">
          <i class="bi bi-cart4"></i><span>Request</span><i></i>
        </a>
      </li><!-- End request Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'employee' %}">
          <i class="bi bi-people"></i><span>Employee</span><i></i>
        </a>
      </li><!-- End employee Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" data-bs-target="#report-nav" data-bs-toggle="collapse" href="#">
          <i class="bx bx-bar-chart"></i><span>Report</span><i class="bi bi-chevron-down ms-auto"></i>
        </a>
        <ul id="report-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
          <li>
            <a href="#">
              <i class="bi bi-circle"></i><span>Today</span>
            </a>
          </li>
          <li>
            <a href="#">
              <i class="bi bi-circle"></i><span>Month</span>
            </a>
          </li>
          <li>
            <a href="#">
              <i class="bi bi-circle"></i><span>year</span>
            </a>
          </li>
          <li>
            <a href="#">
              <i class="bi bi-circle"></i><span>Manual</span>
            </a>
          </li>
        </ul>
      </li><!-- End report Nav -->


  </aside><!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Dashboard</h1>
      <nav>
        <ol class="breadcrumb" style="font-size: 16px !important;">
          <li class="breadcrumb-item"><a href=""><i class="bi bi-house-door" style="color: red !important;"></i></a></li>
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- customers Card -->
            <div class="col-xxl-3 col-md-5" onclick="location.href ='{% url 'customer' %}'">
              <div class="card info-card sales-card">

                <div class="card-body">
                  <center><h4 class="card-title">Customers</h4></center>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-people"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{N_customer}}</h6>
                      <span class="text-success small pt-1 fw-bold">{{inc_custm}}%</span> <span class="text-muted small pt-2 ps-1">increase</span>

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End customers Card -->
            <!-- Request Card -->
            <div class="col-xxl-3 col-md-5">
              <div class="card info-card sales-card">

                <div class="card-body">
                  <center><h4 class="card-title">Request</h4></center>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-cart4"></i>
                    </div>
                    <div class="ps-3">
                      <h6>145</h6>
                      <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span>

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End request Card -->

            <!-- Workers Card -->
            <div class="col-xxl-3 col-md-5" onclick="location.href ='{% url 'employee' %}'">
              <div class="card info-card sales-card">

                <div class="card-body">
                  <center><h5 class="card-title">Employee</h5></center>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-people"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{N_employee}}</h6>
                      <span class="text-success small pt-1 fw-bold">{{inc_emply}}%</span> <span class="text-muted small pt-2 ps-1">increase</span>

                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Workers Card -->

            <!-- Washing point Card -->
            <div class="col-xxl-3 col-xl-5">

              <div class="card info-card sales-card">

                <div class="card-body" onclick="location.href ='{% url 'users' %}'">
                  <center><h5 class="card-title">Washing point</h5></center>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="ri-car-line"></i>
                    </div>
                    <div class="ps-3">
                      <h6>{{N_compy}}</h6>
                      <span class="text-success small pt-1 fw-bold">{{inc_compy}}%</span> <span class="text-muted small pt-2 ps-1">increase</span>

                    </div>
                  </div>

                </div>
              </div>

            </div><!-- End Washingpoint Card -->

            <!-- Reports -->
            <div class="col-lg-5">
              <div class="card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>

                    <li><a class="dropdown-item" href="#">Today</a></li>
                    <li><a class="dropdown-item" href="#">This Month</a></li>
                    <li><a class="dropdown-item" href="#">This Year</a></li>
                  </ul>
                </div>

                <div class="card-body">
                  <h5 class="card-title">Reports <span>/Today</span></h5>

                  <!-- Line Chart -->
                  <div id="reportsChart"></div>

                  <script>
                    document.addEventListener("DOMContentLoaded", () => {
                      //company data 
                      let company_xval = '{% for item in ownerg_data %}{{ item }},{% endfor %}'
                      let company_xval1 = company_xval.split(',')
                      let company_xval2 = company_xval1.pop()
                      let company_yval = '{% for item in ownerg_label %}{{ item }},{% endfor %}'
                      let company_yval1 = company_yval.split(',')
                      let company_yval2 = company_yval1.pop()
                      new ApexCharts(document.querySelector("#reportsChart"), {
                        series: [{
                          name: 'Company',
                          data: company_xval1
                        }],
                        chart: {
                          height: 350,
                          type: 'area',
                          toolbar: {
                            show: false
                          },
                        },
                        markers: {
                          size: 4
                        },
                        colors: ['#2eca6a'],
                        fill: {
                          type: "gradient",
                          gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.3,
                            opacityTo: 0.4,
                            stops: [0, 90, 100]
                          }
                        },
                        dataLabels: {
                          enabled: false
                        },
                        stroke: {
                          curve: 'smooth',
                          width: 4
                        },
                         xaxis: {
                           categories: company_yval1
                        },
                        tooltip: {
                          x: {
                            format: 'MM/yy'
                          },
                        }
                      }).render();
                    });
                  </script>
                  <!-- End Line Chart -->

                </div>

              </div>
            </div><!-- End Reports -->

            <!-- map -->
            <div class="col-lg-7">
                 <!-- mapp -->
                 <div id="map"></div> 
                 <!-- mapp -->
            </div><!-- End map -->

          </div>
        </div><!-- End Left side columns -->
      </div>
    </section>

  </main><!-- End #main -->

{% endblock body%}